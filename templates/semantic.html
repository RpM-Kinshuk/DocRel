{% extends 'base.html' %}

{% block title %}Semantic Analysis{% endblock %}

{% block content %}
    <h1>Semantic Analysis</h1>
    <form id="semantic-form">
        <div class="form-group">
            <label for="query">Enter a query:</label>
            <input type="text" id="query" name="query" required>
        </div>
        
        <div class="form-group">
            <label for="top_n">Enter the number of results needed:</label>
            <input type="number" id="top_n" name="top_n" required value="5">
        </div>

        <div class="form-group" style="border: none;">
            <label>Select Model:</label>
            <div class="radio-group" id="model">
                <label><input type="radio" name="model" value="use" required> Universal Sentence Encoder</label>
                <label><input type="radio" name="model" value="stf"> Sentence Transformers</label>
                <label><input type="radio" name="model" value="fasttext"> fastText</label>
                <label><input type="radio" name="model" value="glove"> GloVe</label>
                <label><input type="radio" name="model" value="elmo"> ELMo</label>
            </div>
        </div>

        <div class="form-group" style="border: none;">
            <label>Select Measure:</label>
            <div class="radio-group" id="sim_measure">
                <label><input type="radio" name="sim_measure" value="cosine" required> Cosine Score</label>
                <label><input type="radio" name="sim_measure" value="euclid"> Euclidean Distance</label>
            </div>
        </div>

        <button type="submit" class="btn-submit">Analyze</button>
    </form>
    <br> <br>
    <div id="loading" style="display: none;">Loading...</div>
    <div id="semantic-results"></div>

    <div id="semantic-results"></div>

    <script>
        document.getElementById('semantic-form').addEventListener('submit', function(event) {
        event.preventDefault();
        
        // Show the loading spinner
        const loadingElement = document.getElementById('loading');
        loadingElement.innerHTML = '<div class="loading-spinner"></div>'; // Add spinner
        loadingElement.style.display = 'block';

        const formData = new FormData(event.target);

        fetch('/semantic', {
            method: 'POST',
            body: new URLSearchParams(formData)
        })
        .then(response => response.json())
        .then(data => {
            const resultsContainer = document.getElementById('semantic-results');
            resultsContainer.innerHTML = ''; // Clear previous results

            // Hide the loading spinner
            loadingElement.style.display = 'none';

            const results = data.results;
            if (results.length > 0) {
                const title = document.createElement('h2');
                title.textContent = 'Results:';
                resultsContainer.appendChild(title); // Add the title

                const ul = document.createElement('ul');
                results.forEach(result => {
                    const li = document.createElement('li');
                    li.textContent = result;
                    ul.appendChild(li);
                });
                resultsContainer.appendChild(ul);
            } else {
                resultsContainer.textContent = 'No results found';
            }
        })
        .catch(error => {
            console.error('Error:', error);
            loadingElement.style.display = 'none'; // Hide spinner on error
        });
    });

</script>

{% endblock %}
